# traefik-dynamic.yml
http:
  middlewares:
    # CORS Middleware for all services
    cors-headers:
      headers:
        accessControlAllowOriginList:
          - "http://localhost:3000"
          - "http://localhost:5173"
          - "http://192.168.1.10:3000"  # For multi-PC deployment
        accessControlAllowMethods:
          - "GET"
          - "POST"
          - "PUT"
          - "DELETE"
          - "PATCH"
          - "OPTIONS"
        accessControlAllowHeaders:
          - "Content-Type"
          - "Authorization"
          - "X-Requested-With"
          - "Accept"
          - "Origin"
        accessControlExposeHeaders:
          - "Content-Length"
          - "Content-Type"
        accessControlAllowCredentials: true
        accessControlMaxAge: 100
        addVaryHeader: true

  # Apply CORS to all routes
  routers:
    auth-service-cors:
      rule: "PathPrefix(`/accounts/`) || PathPrefix(`/api/token/`)"
      service: "auth-service"
      middlewares:
        - cors-headers
      priority: 100

    ride-service-cors:
      rule: "PathPrefix(`/api/rides`) || PathPrefix(`/api/notifications`) || PathPrefix(`/api/internal`)"
      service: "ride-service"
      middlewares:
        - cors-headers
      priority: 90

  services:
    auth-service:
      loadBalancer:
        servers:
          - url: "http://localhost:8000"

    ride-service:
      loadBalancer:
        servers:
          - url: "http://localhost:8001"